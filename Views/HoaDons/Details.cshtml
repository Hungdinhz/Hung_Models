@model Hung_Models.Models.HoaDon

@{
    ViewData["Title"] = "Chi Tiết Hóa Đơn";

    // Định dạng tiền tệ an toàn
    string formattedPrice = Model?.TongTriGia.HasValue == true
                            ? Model.TongTriGia.Value.ToString("#,##0", new System.Globalization.CultureInfo("vi-VN")) + " VNĐ"
                            : "0 VNĐ";

    // Định nghĩa logic hiển thị Trạng Thái bằng Badge
    string GetStatusBadge(int? status)
    {
        return status switch
        {
            0 => "<span class='badge bg-warning text-dark p-2'><i class='bi bi-hourglass-split'></i> Chờ xử lý</span>",
            1 => "<span class='badge bg-info text-dark p-2'><i class='bi bi-check-circle-fill'></i> Đã xác nhận</span>",
            2 => "<span class='badge bg-primary p-2'><i class='bi bi-truck'></i> Đang giao</span>",
            3 => "<span class='badge bg-success p-2'><i class='bi bi-clipboard-check-fill'></i> Hoàn thành</span>",
            4 => "<span class='badge bg-danger p-2'><i class='bi bi-x-circle-fill'></i> Đã hủy</span>",
            _ => "<span class='badge bg-secondary p-2'>Không rõ</span>",
        };
    }
}

<div class="container mt-5">
    <h2 class="text-primary mb-4"><i class="bi bi-card-list"></i> Chi Tiết Hóa Đơn: @Model?.MaHoaDon</h2>
    <hr />

    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Tổng quan về Đơn hàng</h4>
        </div>
        <div class="card-body">

            <dl class="row detail-list">

                <div class="col-md-6 border-end mb-4">
                    <h5 class="text-secondary mb-3"><i class="bi bi-receipt-cutoff"></i> Thông tin giao dịch</h5>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.MaHoaDon)</dt>
                    <dd class="col-sm-8 fw-bold">@Html.DisplayFor(model => model.MaHoaDon)</dd>

                    <dt class="col-sm-4 text-muted">Tổng Trị Giá</dt>
                    <dd class="col-sm-8"><strong class="text-success h4">@formattedPrice</strong></dd>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.NgayHoaDon)</dt>
                    <dd class="col-sm-8">@Model?.NgayHoaDon?.ToString("dd/MM/yyyy")</dd>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.NgayNhan)</dt>
                    <dd class="col-sm-8">@Model?.NgayNhan?.ToString("dd/MM/yyyy")</dd>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.TrangThai)</dt>
                    <dd class="col-sm-8">@Html.Raw(GetStatusBadge(Model?.TrangThai))</dd>

                    <dt class="col-sm-4 text-muted">Khách Hàng ĐK</dt>
                    <dd class="col-sm-8">
                        <i class="bi bi-person-circle text-info"></i>
                        @(Model?.MaKhaHangNavigation?.HoTenKhachHang ?? "Khách vãng lai")
                    </dd>
                </div>

                <div class="col-md-6 mb-4">
                    <h5 class="text-secondary mb-3"><i class="bi bi-geo-alt-fill"></i> Thông tin Người nhận</h5>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.HoTenKhachHang)</dt>
                    <dd class="col-sm-8 fw-bold">@Html.DisplayFor(model => model.HoTenKhachHang)</dd>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.Email)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Email)</dd>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.DienThoai)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.DienThoai)</dd>

                    <dt class="col-sm-4 text-muted">@Html.DisplayNameFor(model => model.DiaChi)</dt>
                    <dd class="col-sm-8 text-wrap">@Html.DisplayFor(model => model.DiaChi)</dd>
                </div>
            </dl>
        </div>

        <div class="card-footer d-flex justify-content-start gap-2">
            <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-warning shadow-sm">
                <i class="bi bi-pencil-square"></i> Chỉnh sửa
            </a>
            <a asp-action="Delete" asp-route-id="@Model?.Id" class="btn btn-danger shadow-sm">
                <i class="bi bi-trash-fill"></i> Xóa
            </a>
            <a asp-action="Index" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Quay lại danh sách
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
}